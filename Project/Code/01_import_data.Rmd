---
title: "Connecting to Fortnite API"
author: "Zack"
output: github_document
---

```{r opts, echo = FALSE}
# puts any figures made into this folder
knitr::opts_chunk$set(
  fig.path = "../Figures/"
)
```

I am going to try to connect to an API for [Fortnite Tracker](https://fortnitetracker.com/). This API gives you stats on every player you have the gamertag of. It updates frequently with current matches played.

Hopefully I can connect to this API becuase it seems like the best option for getting the most relevant data I want to analyze. 

However, I couldn't find any documentation on connecting to it with R. So I am going to use similar code for a different API that uses `httr` package to connect to an API and see if I can connect to Fortnite Tracker that way.

## Attempt to Connect

the `httr` package has documentation to connect to many different API's from website called RapidAPI. I am using this [example](https://rapidapi.com/elreco/api/fortnite-api?endpoint=apiendpoint_a787830a-94d7-4d1b-a625-031462c97605) of a different Forntie API call.

```{r httr-example, include = FALSE}
# Packages
library(tidyverse)
library(httr)

url <- "https://fortnite-api.p.rapidapi.com/stats/zRotation"

response <- VERB("GET", url, add_headers(x_rapidapi_key = '751fdcf83amshb438c02e00cb7f9p189025jsne07cf0e465d3', x_rapidapi_host = 'fortnite-api.p.rapidapi.com'), content_type("application/octet-stream"))

content(response, "text")

```

After some messing around I wasn't able to get it to work so I found another resource [here](https://www.dataquest.io/blog/r-api-tutorial/). This says I can use a package called `jsonlite` along with httr to access API's. So I will try that out, for simplicity I am just going to get data from the in game store. 

```{r setup, eval = FALSE}
# Packages
library(tidyverse)
library(httr)
library(jsonlite)

# Url of API
url <- "https://api.fortnitetracker.com/v1/store"

# # Save API Key to Private Folder
# saveRDS(api_key, here::here("Private", "api_key.rds"))

# Read in API Key
api_key <- readRDS(here::here("Private", "api_key.rds"))

```

Now that I have my packages loaded, key saved, and url added I can run the `httr` code.

```{r httr practice}

# Connect to API
resp <- httr::GET(url,
    add_headers('TRN-API-Key' = api_key))

# Check for any errors
http_error(resp) 

# Get content use "parsed" to make it an r object
result <- httr::content(resp, as = "parsed")

# Convert to dataset
data <- data.frame(result)

```

It worked!! So now let me test getting some player stats. Eventually I will need to make a list of player names that I can look through and create a dataset of data for players.

```{r player stat test}

# base Url of API
url <- "https://api.fortnitetracker.com/v1/profile"

# Platform
platform <- "kbm"

# GamerTag
gamertag <- "ninja"

# Connect to API
resp <- httr::GET(url = paste(url, platform, gamertag, sep = "/"),
    add_headers('TRN-API-Key' = api_key))

# Check for any errors
http_error(resp) 

str(resp)

# Get content use "parsed" to make it an r object
result <- httr::content(resp, as = "raw")

result$stats$

# Convert to dataset
data <- data.frame(result)


```


